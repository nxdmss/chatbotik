#!/bin/bash

# ===============================================
# ๐ ะะะะฃะกะ ะฃะะฃะงะจะะะะะ ะะะะกะะ
# ===============================================

echo "๐ ะะะะฃะกะ ะฃะะฃะงะจะะะะะ ะะะะกะะ"
echo "=================================="

# 1. ะััะฐะฝะฐะฒะปะธะฒะฐะตะผ ะฒัะต ะฟัะพัะตััั
echo "๐ ะััะฐะฝะฐะฒะปะธะฒะฐะตะผ ะฟัะพัะตััั..."
pkill -9 python || true
sleep 2

# 2. ะัะพะฒะตััะตะผ .env ัะฐะนะป
echo "๐ ะัะพะฒะตััะตะผ .env ัะฐะนะป..."
if [ ! -f ".env" ]; then
    echo "โ๏ธ ะกะพะทะดะฐะตะผ .env ัะฐะนะป..."
    echo "BOT_TOKEN=your_real_bot_token_here" > .env
    echo "๐ ะะะะะะะะ: ะะฐะผะตะฝะธัะต 'your_real_bot_token_here' ะฝะฐ ัะตะฐะปัะฝัะน ัะพะบะตะฝ!"
    echo "๐ค ะะพะปััะธัะต ัะพะบะตะฝ ั @BotFather ะฒ Telegram"
fi

# 3. ะกะพะทะดะฐะตะผ ะฟะฐะฟะบั ะดะปั ะธะทะพะฑัะฐะถะตะฝะธะน
echo "๐ ะกะพะทะดะฐะตะผ ะฟะฐะฟะบั ะดะปั ะธะทะพะฑัะฐะถะตะฝะธะน..."
mkdir -p static/images

# 4. ะะฐะฟััะบะฐะตะผ ัะปัััะตะฝะฝัะน ัะตัะฒะตั
echo "๐ ะะฐะฟััะบะฐะตะผ ัะปัััะตะฝะฝัะน ัะตัะฒะตั..."
python3 enhanced_server.py &
SERVER_PID=$!
echo "โ ะกะตัะฒะตั ะทะฐะฟััะตะฝ ั PID: $SERVER_PID"

# 5. ะะดะตะผ ะทะฐะฟััะบะฐ ัะตัะฒะตัะฐ
echo "โณ ะะดะตะผ ะทะฐะฟััะบะฐ ัะตัะฒะตัะฐ..."
sleep 3

# 6. ะัะพะฒะตััะตะผ ัะตัะฒะตั
echo "๐ ะัะพะฒะตััะตะผ ัะตัะฒะตั..."
if curl -s http://localhost:8000 > /dev/null; then
    echo "โ ะกะตัะฒะตั ัะฐะฑะพัะฐะตั ะฝะฐ http://localhost:8000"
else
    echo "โ ะกะตัะฒะตั ะะ ะทะฐะฟััะตะฝ!"
    exit 1
fi

# 7. ะะฐะฟััะบะฐะตะผ ะฑะพัะฐ
echo "๐ค ะะฐะฟััะบะฐะตะผ ะฑะพัะฐ..."
python3 simple_bot.py &
BOT_PID=$!
echo "โ ะะพั ะทะฐะฟััะตะฝ ั PID: $BOT_PID"

echo ""
echo "๐ ะฃะะฃะงะจะะะะะฏ ะะะะกะะฏ ะะะะฃะฉะะะ!"
echo "=================================="
echo "๐ ะะฐะณะฐะทะธะฝ: http://localhost:8000"
echo "๐ ะะพัะทะธะฝะฐ: ะฒัััะพะตะฝะฐ ะฒ ะผะฐะณะฐะทะธะฝ"
echo "โ๏ธ ะะดะผะธะฝ: http://localhost:8000/admin"
echo "๐ค ะะพั: ะฝะฐัััะพะนัะต ัะพะบะตะฝ ะฒ .env"
echo ""
echo "โจ ะะะะซะ ะคะฃะะะฆะะ:"
echo "   ๐ฆ ะขะพะฒะฐัั ะฟะพ 2 ะฒ ัััะพะบะต"
echo "   ๐ผ๏ธ ะคะพัะพะณัะฐัะธะธ ัะพะฒะฐัะพะฒ"
echo "   ๐ ะะพัะทะธะฝะฐ ะฟะพะบัะฟะพะบ"
echo "   โ๏ธ ะฃะปัััะตะฝะฝะฐั ะฐะดะผะธะฝ ะฟะฐะฝะตะปั"
echo "   โ๏ธ ะะตะดะฐะบัะธัะพะฒะฐะฝะธะต ัะพะฒะฐัะพะฒ"
echo "   ๐ ะกัะฐัะธััะธะบะฐ"
echo ""
echo "๐ PID ะฟัะพัะตััะพะฒ:"
echo "   ะกะตัะฒะตั: $SERVER_PID"
echo "   ะะพั: $BOT_PID"
echo ""
echo "๐ ะะปั ะพััะฐะฝะพะฒะบะธ:"
echo "   kill $SERVER_PID $BOT_PID"
echo "=================================="
