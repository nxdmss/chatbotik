#!/bin/bash

# ===============================================
# ๐ ะะะะฃะกะ ะกะะะะะะ ะก ะกะะฅะะะะะะะะ
# ===============================================

echo "๐ ะะะะฃะกะ ะกะะะะะะ ะก ะกะะฅะะะะะะะะ"
echo "=================================="

# 1. ะััะฐะฝะฐะฒะปะธะฒะฐะตะผ ะฒัะต ะฟัะพัะตััั
echo "๐ ะััะฐะฝะฐะฒะปะธะฒะฐะตะผ ะฟัะพัะตััั..."
pkill -9 python || true
sleep 2

# 2. ะัะพะฒะตััะตะผ .env ัะฐะนะป
echo "๐ ะัะพะฒะตััะตะผ .env ัะฐะนะป..."
if [ ! -f ".env" ]; then
    echo "โ๏ธ ะกะพะทะดะฐะตะผ .env ัะฐะนะป..."
    echo "BOT_TOKEN=your_real_bot_token_here" > .env
    echo "๐ ะะะะะะะะ: ะะฐะผะตะฝะธัะต 'your_real_bot_token_here' ะฝะฐ ัะตะฐะปัะฝัะน ัะพะบะตะฝ!"
    echo "๐ค ะะพะปััะธัะต ัะพะบะตะฝ ั @BotFather ะฒ Telegram"
fi

# 3. ะะฐะฟััะบะฐะตะผ ัะตัะฒะตั ั ัะพััะฐะฝะตะฝะธะตะผ
echo "๐ ะะฐะฟััะบะฐะตะผ ัะตัะฒะตั ั ัะพััะฐะฝะตะฝะธะตะผ..."
python3 persistent_server.py &
SERVER_PID=$!
echo "โ ะกะตัะฒะตั ะทะฐะฟััะตะฝ ั PID: $SERVER_PID"

# 4. ะะดะตะผ ะทะฐะฟััะบะฐ ัะตัะฒะตัะฐ
echo "โณ ะะดะตะผ ะทะฐะฟััะบะฐ ัะตัะฒะตัะฐ..."
sleep 3

# 5. ะัะพะฒะตััะตะผ ัะตัะฒะตั
echo "๐ ะัะพะฒะตััะตะผ ัะตัะฒะตั..."
if curl -s http://localhost:8000 > /dev/null; then
    echo "โ ะกะตัะฒะตั ัะฐะฑะพัะฐะตั ะฝะฐ http://localhost:8000"
else
    echo "โ ะกะตัะฒะตั ะะ ะทะฐะฟััะตะฝ!"
    exit 1
fi

# 6. ะะฐะฟััะบะฐะตะผ ะฑะพัะฐ
echo "๐ค ะะฐะฟััะบะฐะตะผ ะฑะพัะฐ..."
python3 simple_bot.py &
BOT_PID=$!
echo "โ ะะพั ะทะฐะฟััะตะฝ ั PID: $BOT_PID"

echo ""
echo "๐ ะกะะะะะ ะก ะกะะฅะะะะะะะะ ะะะะฃะฉะะ!"
echo "=================================="
echo "๐ ะะฐะณะฐะทะธะฝ: http://localhost:8000"
echo "๐ ะะพัะทะธะฝะฐ: ะฒัััะพะตะฝะฐ ะฒ ะผะฐะณะฐะทะธะฝ"
echo "โ๏ธ ะะดะผะธะฝ: ะบะฝะพะฟะบะฐ 'โ๏ธ ะะดะผะธะฝ' ะฒ ะทะฐะณะพะปะพะฒะบะต"
echo "๐พ ะะฐะฝะฝัะต ัะพััะฐะฝััััั ะฒ: products_data.json"
echo "๐ค ะะพั: ะฝะฐัััะพะนัะต ัะพะบะตะฝ ะฒ .env"
echo ""
echo "โจ ะคะฃะะะฆะะ ะกะะฅะะะะะะะฏ:"
echo "   ๐พ ะขะะะะะซ ะกะะฅะะะะฏะฎะขะกะฏ ะะะะกะะะะ"
echo "   ๐ ะคะฐะนะป products_data.json"
echo "   ๐ ะะฒัะพะผะฐัะธัะตัะบะพะต ัะพััะฐะฝะตะฝะธะต"
echo "   ๐ฆ ะะฐะณััะทะบะฐ ะฟัะธ ะทะฐะฟััะบะต"
echo "   ๐๏ธ ะะตะฐะปัะฝะพะต ัะดะฐะปะตะฝะธะต ะธะท ัะฐะนะปะฐ"
echo ""
echo "๐ PID ะฟัะพัะตััะพะฒ:"
echo "   ะกะตัะฒะตั: $SERVER_PID"
echo "   ะะพั: $BOT_PID"
echo ""
echo "๐ ะะปั ะพััะฐะฝะพะฒะบะธ:"
echo "   kill $SERVER_PID $BOT_PID"
echo "=================================="
