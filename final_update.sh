#!/bin/bash

echo "๐ ะคะะะะะฌะะะ ะะะะะะะะะะ ะะะะะะขะ"
echo "================================="

# ะััะฐะฝะพะฒะบะฐ ะฒัะตั ะฟัะพัะตััะพะฒ
echo "๐ ะััะฐะฝะฐะฒะปะธะฒะฐะตะผ ะฒัะต Python ะฟัะพัะตััั..."
pkill -9 python
sleep 2

# ะัะธััะบะฐ ะบะพะฝัะปะธะบััััะธั ัะฐะนะปะพะฒ
echo "๐งน ะัะธัะฐะตะผ ะบะพะฝัะปะธะบััััะธะต ัะฐะนะปั..."
rm -f enhanced_server.py final_server.py persistent_server.py photo_server.py secure_admin_server.py ultra_simple_server.py

# ะกะพััะฐะฝะตะฝะธะต ะธะทะผะตะฝะตะฝะธะน
echo "๐พ ะกะพััะฐะฝัะตะผ ะปะพะบะฐะปัะฝัะต ะธะทะผะตะฝะตะฝะธั..."
git stash

# ะะฑะฝะพะฒะปะตะฝะธะต ะธะท GitHub
echo "๐ฅ ะะฑะฝะพะฒะปัะตะผ ะฟัะพะตะบั ะธะท GitHub..."
git pull origin main

# ะกะพะทะดะฐะฝะธะต ะฝะตะพะฑัะพะดะธะผัั ะฟะฐะฟะพะบ
echo "๐ ะกะพะทะดะฐะตะผ ะฝะตะพะฑัะพะดะธะผัะต ะฟะฐะฟะบะธ..."
mkdir -p uploads
mkdir -p logs

# ะกะพะทะดะฐะฝะธะต .env ัะฐะนะปะฐ ะตัะปะธ ะฝะต ัััะตััะฒัะตั
if [ ! -f .env ]; then
    echo "๐ ะกะพะทะดะฐะตะผ .env ัะฐะนะป..."
    cat > .env << 'EOF'
BOT_TOKEN=your_bot_token_here
ADMIN_ID=1593426947
EOF
    echo "โ๏ธ  ะะะะะ: ะะฐะผะตะฝะธัะต your_bot_token_here ะฝะฐ ัะตะฐะปัะฝัะน ัะพะบะตะฝ ะฑะพัะฐ!"
fi

# ะฃััะฐะฝะพะฒะบะฐ ะทะฐะฒะธัะธะผะพััะตะน
echo "๐ฆ ะฃััะฐะฝะฐะฒะปะธะฒะฐะตะผ ะทะฐะฒะธัะธะผะพััะธ..."
pip install -r requirements.txt

# ะะฐะฟััะบ ัะฐะฑะพัะตะณะพ ัะตัะฒะตัะฐ
echo "๐ ะะฐะฟััะบะฐะตะผ ัะฐะฑะพัะธะน ัะตัะฒะตั..."
python3 working_server.py &
SERVER_PID=$!

# ะะตะฑะพะปััะฐั ะฟะฐัะทะฐ ะดะปั ะทะฐะฟััะบะฐ ัะตัะฒะตัะฐ
sleep 3

# ะัะพะฒะตัะบะฐ ัะฐะฑะพัั ัะตัะฒะตัะฐ
echo "๐ ะัะพะฒะตััะตะผ ัะฐะฑะพัั ัะตัะฒะตัะฐ..."
if curl -s http://localhost:8000/api/products > /dev/null; then
    echo "โ ะกะตัะฒะตั ัะฐะฑะพัะฐะตั!"
    echo "๐ ะะฐะณะฐะทะธะฝ: http://localhost:8000"
    echo "๐ ะะดะผะธะฝ ะฟะฐัะพะปั: admin123"
else
    echo "โ ะัะธะฑะบะฐ ะทะฐะฟััะบะฐ ัะตัะฒะตัะฐ!"
fi

echo ""
echo "๐ ะะะะะะะะะะ ะะะะะะจะะะ!"
echo "================================="
echo "๐ ะะตะฑ-ะฟัะธะปะพะถะตะฝะธะต: http://localhost:8000"
echo "๐ค ะะปั ะทะฐะฟััะบะฐ ะฑะพัะฐ ะฝะฐัััะพะนัะต ัะพะบะตะฝ ะฒ .env"
echo "๐ ะะะะะ ะะะะะะฌ: admin123"
echo "๐ฑ ะะขะะะะะขะ ะะะะะะะะะะ ะงะะะะ ะะะขะ ะ TELEGRAM!"
echo "๐ ะะปั ะพััะฐะฝะพะฒะบะธ: Ctrl+C"
echo "================================="

# ะะถะธะดะฐะฝะธะต ะทะฐะฒะตััะตะฝะธั
wait $SERVER_PID
