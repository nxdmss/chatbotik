#!/bin/bash
# –ü–æ–ª–Ω–æ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∏ –ø–µ—Ä–µ–∑–∞–ø—É—Å–∫

echo "üîÑ –ü–û–õ–ù–û–ï –û–ë–ù–û–í–õ–ï–ù–ò–ï –ò –ü–ï–†–ï–ó–ê–ü–£–°–ö"
echo "================================="

# 1. –û–±–Ω–æ–≤–ª—è–µ–º –ø—Ä–æ–µ–∫—Ç –∏–∑ GitHub
echo "üì• –û–±–Ω–æ–≤–ª—è–µ–º –ø—Ä–æ–µ–∫—Ç –∏–∑ GitHub..."
git pull origin main

# 2. –û—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –í–°–ï –ø—Ä–æ—Ü–µ—Å—Å—ã
echo "üõë –û—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –í–°–ï –ø—Ä–æ—Ü–µ—Å—Å—ã..."
pkill -9 python 2>/dev/null
pkill -9 python3 2>/dev/null
killall -9 python 2>/dev/null
killall -9 python3 2>/dev/null
sleep 3

# 3. –û—Å–≤–æ–±–æ–∂–¥–∞–µ–º –ø–æ—Ä—Ç 8000
echo "üîì –û—Å–≤–æ–±–æ–∂–¥–∞–µ–º –ø–æ—Ä—Ç 8000..."
lsof -ti :8000 | xargs kill -9 2>/dev/null || echo "–ü–æ—Ä—Ç 8000 —Å–≤–æ–±–æ–¥–µ–Ω"
sleep 2

# 4. –ó–∞–ø—É—Å–∫–∞–µ–º —Å–µ—Ä–≤–µ—Ä
echo "üöÄ –ó–∞–ø—É—Å–∫–∞–µ–º —Å–µ—Ä–≤–µ—Ä..."
python3 perfect_server.py &
sleep 5

# 5. –ü—Ä–æ–≤–µ—Ä—è–µ–º —Ä–∞–±–æ—Ç—É
echo "‚úÖ –ü—Ä–æ–≤–µ—Ä—è–µ–º —Ä–∞–±–æ—Ç—É —Å–µ—Ä–≤–µ—Ä–∞..."
if curl -s http://localhost:8000 > /dev/null; then
    echo "‚úÖ –°–µ—Ä–≤–µ—Ä —Ä–∞–±–æ—Ç–∞–µ—Ç –Ω–∞ http://localhost:8000"
else
    echo "‚ùå –û—à–∏–±–∫–∞ –∑–∞–ø—É—Å–∫–∞ —Å–µ—Ä–≤–µ—Ä–∞"
    exit 1
fi

echo ""
echo "================================="
echo "‚úÖ –ü–û–õ–ù–û–ï –û–ë–ù–û–í–õ–ï–ù–ò–ï –ó–ê–í–ï–†–®–ï–ù–û!"
echo ""
echo "üåê –í–µ–±-–ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ: http://localhost:8000"
echo ""
echo "üîß –¢–µ–ø–µ—Ä—å:"
echo "1. –û—Ç–∫—Ä–æ–π—Ç–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ —á–µ—Ä–µ–∑ –±–æ—Ç–∞ –≤ Telegram Desktop"
echo "2. –î–æ–ª–∂–Ω–∞ –ø–æ—è–≤–∏—Ç—å—Å—è –±–æ–ª—å—à–∞—è –∫—Ä–∞—Å–Ω–∞—è –∫–Ω–æ–ø–∫–∞ 'üîß –í–ö–õ–Æ–ß–ò–¢–¨ –ê–î–ú–ò–ù –ü–ê–ù–ï–õ–¨'"
echo "3. –ù–∞–∂–º–∏—Ç–µ –Ω–∞ –∫–Ω–æ–ø–∫—É"
echo "4. –ê–¥–º–∏–Ω –ø–∞–Ω–µ–ª—å –ø–æ—è–≤–∏—Ç—Å—è –º–≥–Ω–æ–≤–µ–Ω–Ω–æ!"
echo ""
echo "üõë –î–ª—è –æ—Å—Ç–∞–Ω–æ–≤–∫–∏: Ctrl+C"
echo "================================="
