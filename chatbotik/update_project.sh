#!/bin/bash

echo "๐ ะะะะะะะะะะ ะะะะะะขะ"
echo "===================="

# 1. ะััะฐะฝะฐะฒะปะธะฒะฐะตะผ ะฒัะต ะฟัะพัะตััั Python
echo "๐ ะััะฐะฝะฐะฒะปะธะฒะฐะตะผ ะฟัะพัะตััั..."
pkill -f python || true
sleep 2

# 2. ะะฑะฝะพะฒะปัะตะผ ะธะท GitHub
echo "๐ฅ ะะฑะฝะพะฒะปัะตะผ ะธะท GitHub..."
git pull origin main

# 3. ะัะธัะฐะตะผ ะฑะฐะทั ะดะฐะฝะฝัั ะพั ะฝะตะฟัะฐะฒะธะปัะฝัั ะทะฐะฟะธัะตะน
echo "๐งน ะัะธัะฐะตะผ ะฑะฐะทั ะดะฐะฝะฝัั..."
sqlite3 shop.db "UPDATE products SET image_url = '' WHERE image_url NOT LIKE '/uploads/%';" 2>/dev/null || true

# 4. ะัะพะฒะตััะตะผ ะฟะฐะฟะบั uploads
echo "๐ ะัะพะฒะตััะตะผ ะฟะฐะฟะบั uploads..."
if [ ! -d "uploads" ]; then
    mkdir -p uploads
    echo "๐ ะกะพะทะดะฐะฝะฐ ะฟะฐะฟะบะฐ uploads"
fi

# 5. ะะฐะฟััะบะฐะตะผ ัะตัะฒะตั
echo "๐ ะะฐะฟััะบะฐะตะผ ัะตัะฒะตั..."
python3 simple_telegram_bot.py &

echo "โ ะะะะะะะะะะ ะะะะะะจะะะ!"
echo "========================"
echo "๐ ะะตะฑ-ะฟัะธะปะพะถะตะฝะธะต: http://localhost:8000"
echo "๐ ะะปั ะพััะฐะฝะพะฒะบะธ: Ctrl+C"
echo "๐ฑ ะัะบัะพะนัะต ะฒ Telegram WebApp ะดะปั ัะตััะธัะพะฒะฐะฝะธั"
