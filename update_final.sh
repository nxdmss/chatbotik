#!/bin/bash

echo "๐ ะะะะะะ ะะะะะะะะะะ ะะะะะะขะ"
echo "=================================="

# 1. ะััะฐะฝะฐะฒะปะธะฒะฐะตะผ ะฒัะต ะฟัะพัะตััั
echo "๐ ะััะฐะฝะฐะฒะปะธะฒะฐะตะผ ะฒัะต ะฟัะพัะตััั..."
pkill -9 python 2>/dev/null || true
pkill -f "perfect_server" 2>/dev/null || true
sleep 3

# 2. ะะฑะฝะพะฒะปัะตะผ ั GitHub
echo "๐ฅ ะะฑะฝะพะฒะปัะตะผ ั GitHub..."
git pull origin main

# 3. ะัะพะฒะตััะตะผ .env ัะฐะนะป
echo "๐ ะัะพะฒะตััะตะผ .env ัะฐะนะป..."
if [ ! -f ".env" ]; then
    echo "โ๏ธ ะกะพะทะดะฐะตะผ .env ัะฐะนะป..."
    cat > .env << EOF
BOT_TOKEN=your_real_bot_token_here
EOF
    echo "โ .env ัะฐะนะป ัะพะทะดะฐะฝ"
    echo "โ๏ธ ะะะะะะะะ: ะ .env ัะฐะนะปะต ััะพะธั ะทะฐะณะปััะบะฐ ัะพะบะตะฝะฐ!"
    echo "๐ ะะฐะผะตะฝะธัะต 'your_real_bot_token_here' ะฝะฐ ัะตะฐะปัะฝัะน ัะพะบะตะฝ ะฑะพัะฐ"
    echo "๐ค ะะพะปััะธัะต ัะพะบะตะฝ ั @BotFather ะฒ Telegram"
else
    echo "โ .env ัะฐะนะป ัััะตััะฒัะตั"
fi

# 4. ะะฐะฟััะบะฐะตะผ ัะตัะฒะตั
echo "๐ ะะฐะฟััะบะฐะตะผ ะฒะตะฑ-ัะตัะฒะตั..."
python3 perfect_server.py &

# 5. ะะดะตะผ ะทะฐะฟััะบะฐ
echo "โณ ะะดะตะผ ะทะฐะฟััะบะฐ ัะตัะฒะตัะฐ..."
sleep 5

# 6. ะัะพะฒะตััะตะผ ัะฐะฑะพัั
echo "๐ ะัะพะฒะตััะตะผ ัะฐะฑะพัั ัะตัะฒะตัะฐ..."
if curl -s http://localhost:8000 > /dev/null; then
    echo "โ ะกะตัะฒะตั ัะฐะฑะพัะฐะตั ะฝะฐ http://localhost:8000"
else
    echo "โ ะกะตัะฒะตั ะฝะต ะพัะฒะตัะฐะตั"
    exit 1
fi

echo ""
echo "๐ ะะะะะะะะะะ ะะะะะะจะะะ!"
echo "=================================="
echo "๐ ะะตะฑ-ะฟัะธะปะพะถะตะฝะธะต: http://localhost:8000"
echo "๐ค ะะปั ะทะฐะฟััะบะฐ ะฑะพัะฐ ะฝะฐัััะพะนัะต ัะพะบะตะฝ ะฒ .env"
echo "๐ ะะดะผะธะฝ ะฟะฐะฝะตะปั ะฒะบะปััะตะฝะฐ ะฐะฒัะพะผะฐัะธัะตัะบะธ ะฒ Telegram WebApp"
echo "๐ ะะปั ะพััะฐะฝะพะฒะบะธ: Ctrl+C"
echo "=================================="
