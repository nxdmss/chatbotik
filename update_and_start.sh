#!/bin/bash

echo "๐ ะะะะะะ ะะะะะะะะะะ ะ ะะะะฃะกะ"
echo "============================="

# ะััะฐะฝะพะฒะบะฐ ะฒัะตั ะฟัะพัะตััะพะฒ
echo "๐ ะััะฐะฝะฐะฒะปะธะฒะฐะตะผ ะฒัะต ะฟัะพัะตััั..."
pkill -9 python
sleep 2

# ะฃะดะฐะปะตะฝะธะต ะฒัะตั ะบะพะฝัะปะธะบััััะธั ัะฐะนะปะพะฒ
echo "๐งน ะัะธัะฐะตะผ ะฒัะต ะบะพะฝัะปะธะบััััะธะต ัะฐะนะปั..."
rm -f shop_data.json
rm -f products_data.json
rm -f products_backup.json

# ะะฑะฝะพะฒะปะตะฝะธะต ะธะท GitHub
echo "๐ฅ ะะฑะฝะพะฒะปัะตะผ ะฟัะพะตะบั ะธะท GitHub..."
git pull origin main

# ะกะพะทะดะฐะฝะธะต ะฝะตะพะฑัะพะดะธะผัั ะฟะฐะฟะพะบ
echo "๐ ะกะพะทะดะฐะตะผ ะฝะตะพะฑัะพะดะธะผัะต ะฟะฐะฟะบะธ..."
mkdir -p uploads
mkdir -p db_backups

# ะะฐะฟััะบ ัะตัะฒะตัะฐ
echo "๐ ะะฐะฟััะบะฐะตะผ ัะตัะฒะตั..."
python3 simple_shop.py &
SERVER_PID=$!

# ะะฐัะทะฐ ะดะปั ะทะฐะฟััะบะฐ
sleep 4

# ะัะพะฒะตัะบะฐ ัะฐะฑะพัั ัะตัะฒะตัะฐ
echo "๐ ะัะพะฒะตััะตะผ ัะฐะฑะพัั ัะตัะฒะตัะฐ..."
if curl -s http://localhost:8000/api/products > /dev/null; then
    echo "โ ะกะตัะฒะตั ัะฐะฑะพัะฐะตั ะพัะปะธัะฝะพ!"
    echo ""
    echo "๐ ะะฐะณะฐะทะธะฝ: http://localhost:8000"
    echo "๐ ะะดะผะธะฝ ะฟะฐัะพะปั: admin123"
    echo "๐ท ะขะตัั ัะพัะพ: http://localhost:8000/test-photo"
    echo "๐งช ะขะตัั ะดะพะฑะฐะฒะปะตะฝะธั: http://localhost:8000/test-simple"
    echo ""
    echo "๐ ะกัะฐััั:"
    echo "   โข ะกะตัะฒะตั: โ ะะฐะฑะพัะฐะตั"
    echo "   โข API: โ ะัะฒะตัะฐะตั"
    echo "   โข ะคะฐะนะปั: โ ะัะธัะตะฝั"
    echo "   โข ะะฑะฝะพะฒะปะตะฝะธั: โ ะัะธะผะตะฝะตะฝั"
else
    echo "โ ะัะธะฑะบะฐ ะทะฐะฟััะบะฐ ัะตัะฒะตัะฐ!"
    echo "ะัะพะฒะตัััะต ะปะพะณะธ ะฒััะต"
fi

echo ""
echo "๐ ะะะขะะะ!"
echo "=============================="
echo "๐ ะะปั ะพััะฐะฝะพะฒะบะธ: Ctrl+C"
echo "=============================="

# ะะถะธะดะฐะฝะธะต ะทะฐะฒะตััะตะฝะธั
wait $SERVER_PID
