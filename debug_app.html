<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–û—Ç–ª–∞–¥–∫–∞ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è</title>
    <link rel="stylesheet" href="/webapp/styles.css">
    <style>
        .debug-panel {
            position: fixed;
            top: 10px;
            right: 10px;
            background: rgba(0, 0, 0, 0.9);
            color: white;
            padding: 15px;
            border-radius: 8px;
            z-index: 10000;
            font-size: 12px;
            max-width: 300px;
            max-height: 400px;
            overflow-y: auto;
        }
        .debug-button {
            background: #007bff;
            color: white;
            border: none;
            padding: 5px 10px;
            margin: 2px;
            border-radius: 4px;
            cursor: pointer;
            font-size: 11px;
        }
        .debug-button:hover {
            background: #0056b3;
        }
        .debug-button.danger {
            background: #dc3545;
        }
        .debug-button.success {
            background: #28a745;
        }
        .debug-log {
            background: rgba(255,255,255,0.1);
            padding: 5px;
            border-radius: 4px;
            margin-top: 10px;
            max-height: 200px;
            overflow-y: auto;
            font-family: monospace;
            font-size: 10px;
        }
    </style>
</head>
<body>
    <div class="debug-panel">
        <h4>üêõ –û—Ç–ª–∞–¥–∫–∞ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è</h4>
        <div>
            <button class="debug-button" onclick="checkApp()">üîç –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ</button>
            <button class="debug-button" onclick="testDelete()">üóëÔ∏è –¢–µ—Å—Ç —É–¥–∞–ª–µ–Ω–∏—è</button>
            <button class="debug-button success" onclick="addTestProduct()">‚ûï –î–æ–±–∞–≤–∏—Ç—å —Ç–æ–≤–∞—Ä</button>
            <button class="debug-button" onclick="clearDebugLog()">üßπ –û—á–∏—Å—Ç–∏—Ç—å –ª–æ–≥</button>
        </div>
        <div class="debug-log" id="debug-log">
            <div>–ì–æ—Ç–æ–≤ –∫ –æ—Ç–ª–∞–¥–∫–µ...</div>
        </div>
    </div>

    <div class="app">
        <!-- –ó–∞–≥–æ–ª–æ–≤–æ–∫ -->
        <header class="header">
            <h1>üõçÔ∏è –ú–∞–≥–∞–∑–∏–Ω (–û—Ç–ª–∞–¥–∫–∞)</h1>
            <div class="cart-badge" id="cart-badge" style="display: none;">0</div>
        </header>

        <!-- –û—Å–Ω–æ–≤–Ω–æ–π –∫–æ–Ω—Ç–µ–Ω—Ç -->
        <main class="main">
            <!-- –ö–∞—Ç–∞–ª–æ–≥ -->
            <div class="page" id="catalog-page">
                <div class="search-container">
                    <input type="text" id="search" placeholder="üîç –ü–æ–∏—Å–∫ —Ç–æ–≤–∞—Ä–æ–≤..." class="search-input">
                </div>
                
                <div class="products-grid" id="products-grid">
                    <!-- –¢–æ–≤–∞—Ä—ã –∑–∞–≥—Ä—É–∂–∞—é—Ç—Å—è –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏ -->
                </div>
                
                <!-- –ö–Ω–æ–ø–∫–∞ –¥–æ–±–∞–≤–ª–µ–Ω–∏—è —Ç–æ–≤–∞—Ä–∞ –¥–ª—è –∞–¥–º–∏–Ω–æ–≤ -->
                <div class="admin-actions" id="admin-actions" style="display: none;">
                    <button class="btn btn-primary btn-lg btn-full" onclick="showAddProductModal()">
                        ‚ûï –î–æ–±–∞–≤–∏—Ç—å —Ç–æ–≤–∞—Ä
                    </button>
                </div>
            </div>

            <!-- –ö–æ—Ä–∑–∏–Ω–∞ -->
            <div class="page" id="cart-page" style="display: none;">
                <div class="cart-header">
                    <h2>üõí –ö–æ—Ä–∑–∏–Ω–∞</h2>
                    <button class="btn btn-outline btn-sm" onclick="clearCart()">–û—á–∏—Å—Ç–∏—Ç—å</button>
                </div>
                
                <div class="cart-items" id="cart-items">
                    <!-- –¢–æ–≤–∞—Ä—ã –≤ –∫–æ—Ä–∑–∏–Ω–µ -->
                </div>
                
                <div class="cart-footer">
                    <div class="cart-total">
                        <span>–ò—Ç–æ–≥–æ: <span id="cart-total">0 ‚ÇΩ</span></span>
                    </div>
                    <button class="btn btn-primary btn-lg btn-full" onclick="checkout()">
                        üí≥ –û—Ñ–æ—Ä–º–∏—Ç—å –∑–∞–∫–∞–∑
                    </button>
                </div>
            </div>

            <!-- –ü—Ä–æ—Ñ–∏–ª—å -->
            <div class="page" id="profile-page" style="display: none;">
                <div class="profile-header">
                    <h2>üë§ –ü—Ä–æ—Ñ–∏–ª—å</h2>
                </div>
                
                <div class="profile-content">
                    <div class="profile-info">
                        <p>–î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å –≤ –Ω–∞—à –º–∞–≥–∞–∑–∏–Ω!</p>
                        <p>–ó–¥–µ—Å—å –≤—ã –º–æ–∂–µ—Ç–µ —É–ø—Ä–∞–≤–ª—è—Ç—å —Å–≤–æ–∏–º–∏ –∑–∞–∫–∞–∑–∞–º–∏ –∏ –Ω–∞—Å—Ç—Ä–æ–π–∫–∞–º–∏.</p>
                    </div>
                    
                    <div class="profile-actions">
                        <button class="btn btn-outline btn-full" onclick="showModal('orders-modal')">
                            üì¶ –ú–æ–∏ –∑–∞–∫–∞–∑—ã
                        </button>
                        <button class="btn btn-outline btn-full" onclick="showModal('faq-modal')">
                            ‚ùì FAQ
                        </button>
                        <button class="btn btn-outline btn-full" onclick="contactAdmin()">
                            üìû –°–≤—è–∑–∞—Ç—å—Å—è —Å –Ω–∞–º–∏
                        </button>
                    </div>
                </div>
            </div>

            <!-- –ê–¥–º–∏–Ω-–ø–∞–Ω–µ–ª—å -->
            <div class="page" id="admin-page" style="display: none;">
                <div class="admin-header">
                    <h2>‚öôÔ∏è –ê–¥–º–∏–Ω-–ø–∞–Ω–µ–ª—å</h2>
                </div>
                
                <div class="admin-content">
                    <div class="admin-stats" id="admin-stats">
                        <div class="stat-card">
                            <h3>–¢–æ–≤–∞—Ä—ã</h3>
                            <span id="products-count">0</span>
                        </div>
                        <div class="stat-card">
                            <h3>–ó–∞–∫–∞–∑—ã</h3>
                            <span id="orders-count">0</span>
                        </div>
                    </div>
                    
                    <div class="admin-products">
                        <div class="admin-products-header">
                            <h3>–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Ç–æ–≤–∞—Ä–∞–º–∏</h3>
                            <button class="btn btn-primary btn-sm" onclick="showAddProductModal()">
                                ‚ûï –î–æ–±–∞–≤–∏—Ç—å —Ç–æ–≤–∞—Ä
                            </button>
                        </div>
                        
                        <div class="products-list" id="admin-products-list">
                            <!-- –°–ø–∏—Å–æ–∫ —Ç–æ–≤–∞—Ä–æ–≤ –¥–ª—è –∞–¥–º–∏–Ω–∞ -->
                        </div>
                    </div>
                </div>
            </div>
        </main>

        <!-- –ù–∞–≤–∏–≥–∞—Ü–∏—è -->
        <nav class="nav">
            <button class="nav-item active" data-page="catalog">
                <span class="nav-icon">üõçÔ∏è</span>
                <span class="nav-label">–ö–∞—Ç–∞–ª–æ–≥</span>
            </button>
            <button class="nav-item" data-page="cart">
                <span class="nav-icon">üõí</span>
                <span class="nav-label">–ö–æ—Ä–∑–∏–Ω–∞</span>
            </button>
            <button class="nav-item" data-page="profile">
                <span class="nav-icon">üë§</span>
                <span class="nav-label">–ü—Ä–æ—Ñ–∏–ª—å</span>
            </button>
            <button class="nav-item" data-page="admin" id="admin-nav-btn" style="display: none;">
                <span class="nav-icon">‚öôÔ∏è</span>
                <span class="nav-label">–ê–¥–º–∏–Ω</span>
            </button>
        </nav>
    </div>

    <!-- –ú–æ–¥–∞–ª—å–Ω—ã–µ –æ–∫–Ω–∞ -->
    
    <!-- –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –∑–∞–∫–∞–∑–æ–≤ -->
    <div class="modal" id="orders-modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>üì¶ –ú–æ–∏ –∑–∞–∫–∞–∑—ã</h3>
                <button class="modal-close" onclick="hideModal('orders-modal')">&times;</button>
            </div>
            <div class="modal-body">
                <p>–ó–¥–µ—Å—å –±—É–¥—É—Ç –æ—Ç–æ–±—Ä–∞–∂–∞—Ç—å—Å—è –≤–∞—à–∏ –∑–∞–∫–∞–∑—ã.</p>
            </div>
        </div>
    </div>

    <!-- –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ FAQ -->
    <div class="modal" id="faq-modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>‚ùì –ß–∞—Å—Ç–æ –∑–∞–¥–∞–≤–∞–µ–º—ã–µ –≤–æ–ø—Ä–æ—Å—ã</h3>
                <button class="modal-close" onclick="hideModal('faq-modal')">&times;</button>
            </div>
            <div class="modal-body">
                <div class="faq-item">
                    <h4>–ö–∞–∫ —Å–¥–µ–ª–∞—Ç—å –∑–∞–∫–∞–∑?</h4>
                    <p>–í—ã–±–µ—Ä–∏—Ç–µ —Ç–æ–≤–∞—Ä—ã –≤ –∫–∞—Ç–∞–ª–æ–≥–µ, –¥–æ–±–∞–≤—å—Ç–µ –∏—Ö –≤ –∫–æ—Ä–∑–∏–Ω—É –∏ –æ—Ñ–æ—Ä–º–∏—Ç–µ –∑–∞–∫–∞–∑.</p>
                </div>
                <div class="faq-item">
                    <h4>–ö–∞–∫ –æ–ø–ª–∞—Ç–∏—Ç—å –∑–∞–∫–∞–∑?</h4>
                    <p>–û–ø–ª–∞—Ç–∞ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç —á–µ—Ä–µ–∑ Telegram Payments.</p>
                </div>
                <div class="faq-item">
                    <h4>–°–∫–æ–ª—å–∫–æ –≤—Ä–µ–º–µ–Ω–∏ –¥–æ—Å—Ç–∞–≤–∫–∞?</h4>
                    <p>–û–±—ã—á–Ω–æ 1-3 —Ä–∞–±–æ—á–∏—Ö –¥–Ω—è.</p>
                </div>
            </div>
        </div>
    </div>

    <!-- –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –¥–æ–±–∞–≤–ª–µ–Ω–∏—è/—Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è —Ç–æ–≤–∞—Ä–∞ -->
    <div class="modal" id="product-modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 id="product-modal-title">‚ûï –î–æ–±–∞–≤–∏—Ç—å —Ç–æ–≤–∞—Ä</h3>
                <button class="modal-close" onclick="hideModal('product-modal')">&times;</button>
            </div>
            <div class="modal-body">
                <form id="product-form" enctype="multipart/form-data">
                    <div class="form-group">
                        <label for="product-title">–ù–∞–∑–≤–∞–Ω–∏–µ —Ç–æ–≤–∞—Ä–∞</label>
                        <input type="text" id="product-title" name="title" required>
                    </div>
                    
                    <div class="form-group">
                        <label for="product-description">–û–ø–∏—Å–∞–Ω–∏–µ</label>
                        <textarea id="product-description" name="description" rows="3" required></textarea>
                    </div>
                    
                    <div class="form-group">
                        <label for="product-price">–¶–µ–Ω–∞ (‚ÇΩ)</label>
                        <input type="number" id="product-price" name="price" min="0" step="0.01" required>
                    </div>
                    
                    <div class="form-group">
                        <label for="product-sizes">–†–∞–∑–º–µ—Ä—ã (—á–µ—Ä–µ–∑ –∑–∞–ø—è—Ç—É—é)</label>
                        <input type="text" id="product-sizes" name="sizes" placeholder="40, 41, 42, 43">
                    </div>
                    
                    <div class="form-group">
                        <label for="product-photo">–§–æ—Ç–æ —Ç–æ–≤–∞—Ä–∞</label>
                        <input type="file" id="product-photo" name="photo" accept="image/*">
                        <div class="photo-preview" id="photo-preview" style="display: none;">
                            <img id="preview-img" src="" alt="–ü—Ä–µ–¥–≤–∞—Ä–∏—Ç–µ–ª—å–Ω—ã–π –ø—Ä–æ—Å–º–æ—Ç—Ä">
                        </div>
                    </div>
                    
                    <div class="form-actions">
                        <button type="button" class="btn btn-outline" onclick="hideModal('product-modal')">
                            –û—Ç–º–µ–Ω–∞
                        </button>
                        <button type="submit" class="btn btn-primary">
                            –°–æ—Ö—Ä–∞–Ω–∏—Ç—å
                        </button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <script src="/webapp/app.js"></script>
    
    <script>
        function debugLog(message, type = 'info') {
            const logDiv = document.getElementById('debug-log');
            const timestamp = new Date().toLocaleTimeString();
            const color = type === 'error' ? '#ff6b6b' : type === 'success' ? '#51cf66' : '#74c0fc';
            logDiv.innerHTML += `<div style="color: ${color};">[${timestamp}] ${message}</div>`;
            logDiv.scrollTop = logDiv.scrollHeight;
        }
        
        function clearDebugLog() {
            document.getElementById('debug-log').innerHTML = '<div>–õ–æ–≥ –æ—á–∏—â–µ–Ω...</div>';
        }
        
        function checkApp() {
            debugLog('üîç –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å–æ—Å—Ç–æ—è–Ω–∏—è –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è...');
            debugLog(`window.mobileShopApp: ${!!window.mobileShopApp}`);
            debugLog(`isAdmin: ${window.mobileShopApp?.isAdmin || 'N/A'}`);
            debugLog(`products.length: ${window.mobileShopApp?.products?.length || 'N/A'}`);
            debugLog(`currentPage: ${window.mobileShopApp?.currentPage || 'N/A'}`);
            
            // –ü—Ä–æ–≤–µ—Ä—è–µ–º DOM —ç–ª–µ–º–µ–Ω—Ç—ã
            const adminNavBtn = document.getElementById('admin-nav-btn');
            const adminActions = document.getElementById('admin-actions');
            debugLog(`admin-nav-btn display: ${adminNavBtn?.style.display || 'N/A'}`);
            debugLog(`admin-actions display: ${adminActions?.style.display || 'N/A'}`);
            
            // –ü—Ä–æ–≤–µ—Ä—è–µ–º —Ç–æ–≤–∞—Ä—ã –≤ –∫–∞—Ç–∞–ª–æ–≥–µ
            const productsGrid = document.getElementById('products-grid');
            const productCards = productsGrid?.querySelectorAll('.product-card');
            debugLog(`–¢–æ–≤–∞—Ä–æ–≤ –≤ –∫–∞—Ç–∞–ª–æ–≥–µ: ${productCards?.length || 0}`);
            
            if (productCards && productCards.length > 0) {
                productCards.forEach((card, index) => {
                    const deleteBtn = card.querySelector('button[onclick*="deleteProduct"]');
                    debugLog(`–¢–æ–≤–∞—Ä ${index + 1}: –∫–Ω–æ–ø–∫–∞ —É–¥–∞–ª–µ–Ω–∏—è ${deleteBtn ? '–Ω–∞–π–¥–µ–Ω–∞' : '–ù–ï –ù–ê–ô–î–ï–ù–ê'}`);
                });
            }
        }
        
        function testDelete() {
            debugLog('üóëÔ∏è –¢–µ—Å—Ç–∏—Ä—É–µ–º —É–¥–∞–ª–µ–Ω–∏–µ...');
            if (window.mobileShopApp && window.mobileShopApp.products.length > 0) {
                const firstProduct = window.mobileShopApp.products[0];
                debugLog(`–ü—ã—Ç–∞–µ–º—Å—è —É–¥–∞–ª–∏—Ç—å —Ç–æ–≤–∞—Ä #${firstProduct.id}`);
                deleteProduct(firstProduct.id);
            } else {
                debugLog('‚ùå –ù–µ—Ç —Ç–æ–≤–∞—Ä–æ–≤ –¥–ª—è —É–¥–∞–ª–µ–Ω–∏—è', 'error');
            }
        }
        
        async function addTestProduct() {
            debugLog('‚ûï –î–æ–±–∞–≤–ª—è–µ–º —Ç–µ—Å—Ç–æ–≤—ã–π —Ç–æ–≤–∞—Ä...');
            try {
                const formData = new FormData();
                formData.append('title', '–¢–µ—Å—Ç–æ–≤—ã–π —Ç–æ–≤–∞—Ä –¥–ª—è –æ—Ç–ª–∞–¥–∫–∏');
                formData.append('description', '–≠—Ç–æ—Ç —Ç–æ–≤–∞—Ä —Å–æ–∑–¥–∞–Ω –¥–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è —É–¥–∞–ª–µ–Ω–∏—è');
                formData.append('price', '2000');
                formData.append('sizes', 'M,L,XL');
                formData.append('user_id', 'admin');
                
                const response = await fetch('/webapp/admin/products', {
                    method: 'POST',
                    body: formData,
                });
                
                if (response.ok) {
                    const result = await response.json();
                    debugLog(`‚úÖ –¢–µ—Å—Ç–æ–≤—ã–π —Ç–æ–≤–∞—Ä –¥–æ–±–∞–≤–ª–µ–Ω! ID: ${result.product_id}`, 'success');
                    // –û–±–Ω–æ–≤–ª—è–µ–º –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ
                    if (window.mobileShopApp) {
                        await window.mobileShopApp.fetchProducts();
                        window.mobileShopApp.renderCatalogPage();
                    }
                } else {
                    debugLog(`‚ùå –û—à–∏–±–∫–∞ –¥–æ–±–∞–≤–ª–µ–Ω–∏—è: ${response.status}`, 'error');
                }
            } catch (error) {
                debugLog(`‚ùå –û—à–∏–±–∫–∞ —Å–µ—Ç–∏: ${error.message}`, 'error');
            }
        }
        
        // –ü–µ—Ä–µ—Ö–≤–∞—Ç—ã–≤–∞–µ–º console.log –¥–ª—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è –≤ –ª–æ–≥–µ
        const originalLog = console.log;
        console.log = function(...args) {
            originalLog.apply(console, args);
            const message = args.join(' ');
            if (message.includes('üóëÔ∏è') || message.includes('‚ùå') || message.includes('‚úÖ') || message.includes('üîç')) {
                debugLog(message);
            }
        };
        
        // –ü–µ—Ä–µ—Ö–≤–∞—Ç—ã–≤–∞–µ–º console.error
        const originalError = console.error;
        console.error = function(...args) {
            originalError.apply(console, args);
            const message = args.join(' ');
            debugLog(message, 'error');
        };
        
        // –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ
        window.addEventListener('load', () => {
            setTimeout(checkApp, 1000);
        });
    </script>
</body>
</html>
