# üîß –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è —É–¥–∞–ª–µ–Ω–∏—è —Ç–æ–≤–∞—Ä–æ–≤ –≤ Telegram WebApp

## üìã –ü—Ä–æ–±–ª–µ–º–∞

–ü—Ä–∏ —É–¥–∞–ª–µ–Ω–∏–∏ —Ç–æ–≤–∞—Ä–æ–≤ —á–µ—Ä–µ–∑ Telegram WebApp –≤–æ–∑–Ω–∏–∫–∞–ª–∏ –æ—à–∏–±–∫–∏. –¢–æ–≤–∞—Ä—ã –Ω–µ —É–¥–∞–ª—è–ª–∏—Å—å –∏–∑ –∫–∞—Ç–∞–ª–æ–≥–∞.

## üîç –ù–∞–π–¥–µ–Ω–Ω—ã–µ –ø—Ä–æ–±–ª–µ–º—ã

### 1. **–ü—Ä–æ–≤–µ—Ä–∫–∞ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞**
- **–ü—Ä–æ–±–ª–µ–º–∞:** –§—É–Ω–∫—Ü–∏—è `is_admin()` –ø—Ä–æ–≤–µ—Ä—è–ª–∞ —Ç–æ–ª—å–∫–æ –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã–π Telegram ID, –Ω–æ –≤–µ–±-–ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –ø–µ—Ä–µ–¥–∞–≤–∞–ª–æ `user_id=admin`
- **–†–µ—à–µ–Ω–∏–µ:** –î–æ–±–∞–≤–∏–ª–∏ –ø—Ä–æ–≤–µ—Ä–∫—É –¥–ª—è —Å—Ç—Ä–æ–∫–∏ "admin" –≤ —Ñ—É–Ω–∫—Ü–∏–∏ `is_admin()`

```python
def is_admin(user_id: str) -> bool:
    user_id_str = str(user_id)
    # –ï–¥–∏–Ω—Å—Ç–≤–µ–Ω–Ω—ã–π –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä –∏–ª–∏ —Ç–µ—Å—Ç–æ–≤—ã–π admin
    return user_id_str == "1593426947" or user_id_str == "admin"
```

### 2. **–§—É–Ω–∫—Ü–∏—è update_product_status –Ω–µ —Ä–∞–±–æ—Ç–∞–ª–∞**
- **–ü—Ä–æ–±–ª–µ–º–∞:** –§—É–Ω–∫—Ü–∏—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–ª–∞—Å—å —Å `await`, –Ω–æ –Ω–µ –±—ã–ª–∞ –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ–π
- **–†–µ—à–µ–Ω–∏–µ:** –£–±—Ä–∞–ª–∏ `await` –ø—Ä–∏ –≤—ã–∑–æ–≤–µ —Ñ—É–Ω–∫—Ü–∏–∏

```python
# –ë—ã–ª–æ:
success = await db.update_product_status(product_id, False)

# –°—Ç–∞–ª–æ:
success = db.update_product_status(product_id, False)
```

### 3. **–ü—Ä–æ–±–ª–µ–º–∞ —Å —Ç–∏–ø–∞–º–∏ –¥–∞–Ω–Ω—ã—Ö –≤ SQLite**
- **–ü—Ä–æ–±–ª–µ–º–∞:** –ó–∞–ø—Ä–æ—Å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–ª `WHERE is_active = TRUE`, –Ω–æ SQLite —Ö—Ä–∞–Ω–∏—Ç –∫–∞–∫ `1`/`0`
- **–†–µ—à–µ–Ω–∏–µ:** –ò–∑–º–µ–Ω–∏–ª–∏ –∑–∞–ø—Ä–æ—Å –Ω–∞ `WHERE is_active = 1`

```python
# –ë—ã–ª–æ:
query += " WHERE is_active = TRUE"

# –°—Ç–∞–ª–æ:
query += " WHERE is_active = 1"
```

### 4. **–ö–æ–Ω—Ñ–ª–∏–∫—Ç —Å—Ç–∞—Ç–∏—á–µ—Å–∫–∏—Ö JSON —Ñ–∞–π–ª–æ–≤ —Å API**
- **–ü—Ä–æ–±–ª–µ–º–∞:** –°—Ç–∞—Ç–∏—á–µ—Å–∫–∏–µ —Ñ–∞–π–ª—ã `webapp/products.json` –∏ `webapp/static/products.json` –ø–µ—Ä–µ–∫—Ä—ã–≤–∞–ª–∏ API —ç–Ω–¥–ø–æ–∏–Ω—Ç—ã
- **–†–µ—à–µ–Ω–∏–µ:** –ü–µ—Ä–µ–∏–º–µ–Ω–æ–≤–∞–ª–∏ —Å—Ç–∞—Ç–∏—á–µ—Å–∫–∏–µ —Ñ–∞–π–ª—ã –≤ `.backup` –∏ –∏–∑–º–µ–Ω–∏–ª–∏ API —ç–Ω–¥–ø–æ–∏–Ω—Ç –Ω–∞ `/api/products`

```python
# –ë—ã–ª–æ:
@app.get("/webapp/products.json")

# –°—Ç–∞–ª–æ:
@app.get("/api/products")
```

### 5. **–£–ª—É—á—à–µ–Ω–æ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ**
- –î–æ–±–∞–≤–ª–µ–Ω–æ –ø–æ–¥—Ä–æ–±–Ω–æ–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –≤ —Ñ—É–Ω–∫—Ü–∏–∏ `update_product_status()`
- –î–æ–±–∞–≤–ª–µ–Ω–æ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –≤ —ç–Ω–¥–ø–æ–∏–Ω—Ç `delete_product()`
- –î–æ–±–∞–≤–ª–µ–Ω–æ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –≤ —Ñ—É–Ω–∫—Ü–∏—é `get_products()`

## ‚úÖ –†–µ–∑—É–ª—å—Ç–∞—Ç

–¢–µ–ø–µ—Ä—å —É–¥–∞–ª–µ–Ω–∏–µ —Ç–æ–≤–∞—Ä–æ–≤ —Ä–∞–±–æ—Ç–∞–µ—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ:

1. ‚úÖ –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø—Ä–∞–≤ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞ —Ä–∞–±–æ—Ç–∞–µ—Ç
2. ‚úÖ –§—É–Ω–∫—Ü–∏—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è —Å—Ç–∞—Ç—É—Å–∞ —Ç–æ–≤–∞—Ä–∞ —Ä–∞–±–æ—Ç–∞–µ—Ç
3. ‚úÖ –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö –ø—Ä–∞–≤–∏–ª—å–Ω–æ –æ–±–Ω–æ–≤–ª—è–µ—Ç—Å—è
4. ‚úÖ API –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç –∞–∫—Ç—É–∞–ª—å–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ –∏–∑ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö
5. ‚úÖ –î–æ–±–∞–≤–ª–µ–Ω–æ –ø–æ–¥—Ä–æ–±–Ω–æ–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –¥–ª—è –æ—Ç–ª–∞–¥–∫–∏

## üöÄ –ò–∑–º–µ–Ω–µ–Ω–Ω—ã–µ —Ñ–∞–π–ª—ã

1. **`server.py`**:
   - –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∞ —Ñ—É–Ω–∫—Ü–∏—è `is_admin()`
   - –£–±—Ä–∞–Ω `await` –ø—Ä–∏ –≤—ã–∑–æ–≤–µ `update_product_status()`
   - –î–æ–±–∞–≤–ª–µ–Ω–æ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –≤ `delete_product()`
   - –ò–∑–º–µ–Ω–µ–Ω —ç–Ω–¥–ø–æ–∏–Ω—Ç –Ω–∞ `/api/products`

2. **`database.py`**:
   - –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∞ —Ñ—É–Ω–∫—Ü–∏—è `update_product_status()` —Å –¥–æ–±–∞–≤–ª–µ–Ω–∏–µ–º –ø—Ä–æ–≤–µ—Ä–æ–∫
   - –ò—Å–ø—Ä–∞–≤–ª–µ–Ω SQL –∑–∞–ø—Ä–æ—Å –≤ `get_products()` (TRUE ‚Üí 1)
   - –î–æ–±–∞–≤–ª–µ–Ω–æ –ø–æ–¥—Ä–æ–±–Ω–æ–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ

3. **`webapp/products.json`** –∏ **`webapp/static/products.json`**:
   - –ü–µ—Ä–µ–∏–º–µ–Ω–æ–≤–∞–Ω—ã –≤ `.backup` –¥–ª—è –ø—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–µ–Ω–∏—è –∫–æ–Ω—Ñ–ª–∏–∫—Ç–æ–≤ —Å API

## üìù –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏

1. –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å `/api/products` –≤–º–µ—Å—Ç–æ `/webapp/products.json` –≤ –≤–µ–±-–ø—Ä–∏–ª–æ–∂–µ–Ω–∏–∏
2. –î–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å `user_id=admin` –∏–ª–∏ –Ω–∞—Å—Ç–æ—è—â–∏–π Telegram ID –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞
3. –ü—Ä–æ–≤–µ—Ä—è—Ç—å –ª–æ–≥–∏ —Å–µ—Ä–≤–µ—Ä–∞ –¥–ª—è –æ—Ç–ª–∞–¥–∫–∏ (–¥–æ–±–∞–≤–ª–µ–Ω–æ –¥–µ—Ç–∞–ª—å–Ω–æ–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ)

## üß™ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

```bash
# –¢–µ—Å—Ç —É–¥–∞–ª–µ–Ω–∏—è —Ç–æ–≤–∞—Ä–∞
curl -X DELETE "http://localhost:8000/webapp/admin/products/1?user_id=admin"

# –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ç–æ–≤–∞—Ä–æ–≤
curl "http://localhost:8000/api/products"

# –ü—Ä–æ–≤–µ—Ä–∫–∞ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö –Ω–∞–ø—Ä—è–º—É—é
sqlite3 shop.db "SELECT id, title, is_active FROM products;"
```

---

**–î–∞—Ç–∞ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è:** 12 –æ–∫—Ç—è–±—Ä—è 2025  
**–°—Ç–∞—Ç—É—Å:** ‚úÖ –í—Å–µ –ø—Ä–æ–±–ª–µ–º—ã –∏—Å–ø—Ä–∞–≤–ª–µ–Ω—ã
