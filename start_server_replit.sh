#!/bin/bash
# –°–∫—Ä–∏–ø—Ç –¥–ª—è –∑–∞–ø—É—Å–∫–∞ —Å–µ—Ä–≤–µ—Ä–∞ –≤ Replit —Å –¥—Ä—É–≥–∏–º –ø–æ—Ä—Ç–æ–º

echo "============================================"
echo "üöÄ –ó–ê–ü–£–°–ö –°–ï–†–í–ï–†–ê –í REPLIT"
echo "============================================"

# –£–±–∏–≤–∞–µ–º –≤—Å–µ Python –ø—Ä–æ—Ü–µ—Å—Å—ã
echo "üõë –û—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –≤—Å–µ Python –ø—Ä–æ—Ü–µ—Å—Å—ã..."
pkill -9 -f "python" 2>/dev/null
sleep 2

# –ü—Ä–æ–≤–µ—Ä—è–µ–º –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç—å –ø–æ—Ä—Ç–æ–≤
echo "üîç –ü—Ä–æ–≤–µ—Ä—è–µ–º –¥–æ—Å—Ç—É–ø–Ω—ã–µ –ø–æ—Ä—Ç—ã..."

# –ü—Ä–æ–±—É–µ–º –ø–æ—Ä—Ç 3000
if ! lsof -i :3000 >/dev/null 2>&1; then
    echo "‚úÖ –ü–æ—Ä—Ç 3000 —Å–≤–æ–±–æ–¥–µ–Ω"
    PORT=3000
elif ! lsof -i :3001 >/dev/null 2>&1; then
    echo "‚úÖ –ü–æ—Ä—Ç 3001 —Å–≤–æ–±–æ–¥–µ–Ω"
    PORT=3001
elif ! lsof -i :5000 >/dev/null 2>&1; then
    echo "‚úÖ –ü–æ—Ä—Ç 5000 —Å–≤–æ–±–æ–¥–µ–Ω"
    PORT=5000
else
    echo "‚ö†Ô∏è –í—Å–µ –ø–æ—Ä—Ç—ã –∑–∞–Ω—è—Ç—ã, –∏—Å–ø–æ–ª—å–∑—É–µ–º 8000"
    PORT=8000
fi

echo "üåê –ò—Å–ø–æ–ª—å–∑—É–µ–º –ø–æ—Ä—Ç: $PORT"

# –í—Ä–µ–º–µ–Ω–Ω–æ –º–µ–Ω—è–µ–º –ø–æ—Ä—Ç –≤ perfect_server.py
if [ "$PORT" != "8000" ]; then
    echo "üîß –í—Ä–µ–º–µ–Ω–Ω–æ –º–µ–Ω—è–µ–º –ø–æ—Ä—Ç –Ω–∞ $PORT..."
    sed -i "s/PORT = 8000/PORT = $PORT/" perfect_server.py
fi

# –ó–∞–ø—É—Å–∫–∞–µ–º —Å–µ—Ä–≤–µ—Ä
echo ""
echo "============================================"
echo "üöÄ –ó–ê–ü–£–°–ö –°–ï–†–í–ï–†–ê –ù–ê –ü–û–†–¢–£ $PORT"
echo "============================================"
echo ""

python3 perfect_server.py
