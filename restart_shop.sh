#!/bin/bash

echo "๐ ะะะะะะ ะะะะะะะะฃะกะ ะะะะะะะะ"
echo "=============================="

# ะััะฐะฝะพะฒะบะฐ ะฒัะตั ะฟัะพัะตััะพะฒ
echo "๐ ะััะฐะฝะฐะฒะปะธะฒะฐะตะผ ะฒัะต Python ะฟัะพัะตััั..."
pkill -9 python
sleep 3

# ะฃะดะฐะปะตะฝะธะต ะบะพะฝัะปะธะบััััะธั ัะฐะนะปะพะฒ
echo "๐งน ะัะธัะฐะตะผ ะบะพะฝัะปะธะบััััะธะต ัะฐะนะปั..."
rm -f shop_data.json

# ะะฑะฝะพะฒะปะตะฝะธะต ะธะท GitHub
echo "๐ฅ ะะฑะฝะพะฒะปัะตะผ ะฟัะพะตะบั ะธะท GitHub..."
git pull origin main

# ะกะพะทะดะฐะฝะธะต ะฝะตะพะฑัะพะดะธะผัั ะฟะฐะฟะพะบ
echo "๐ ะกะพะทะดะฐะตะผ ะฝะตะพะฑัะพะดะธะผัะต ะฟะฐะฟะบะธ..."
mkdir -p uploads

# ะะฐะฟััะบ ัะตัะฒะตัะฐ
echo "๐ ะะฐะฟััะบะฐะตะผ ัะตัะฒะตั..."
python3 simple_shop.py &
SERVER_PID=$!

# ะะฐัะทะฐ ะดะปั ะทะฐะฟััะบะฐ
sleep 3

# ะัะพะฒะตัะบะฐ ัะฐะฑะพัั ัะตัะฒะตัะฐ
echo "๐ ะัะพะฒะตััะตะผ ัะฐะฑะพัั ัะตัะฒะตัะฐ..."
if curl -s http://localhost:8000/api/products > /dev/null; then
    echo "โ ะกะตัะฒะตั ัะฐะฑะพัะฐะตั!"
    echo "๐ ะะฐะณะฐะทะธะฝ: http://localhost:8000"
    echo "๐ ะะดะผะธะฝ ะฟะฐัะพะปั: admin123"
    echo "๐ท ะขะตัั ัะพัะพ: http://localhost:8000/test-photo"
else
    echo "โ ะัะธะฑะบะฐ ะทะฐะฟััะบะฐ ัะตัะฒะตัะฐ!"
    echo "ะัะพะฒะตัััะต ะปะพะณะธ ะฒััะต"
fi

echo ""
echo "๐ ะะะขะะะ!"
echo "=============================="
echo "๐ ะะปั ะพััะฐะฝะพะฒะบะธ: Ctrl+C"
echo "=============================="

# ะะถะธะดะฐะฝะธะต ะทะฐะฒะตััะตะฝะธั
wait $SERVER_PID
